<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galapagos Logistics - Tableau de bord</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-7xl mx-auto">
        <!-- En-t√™te -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-4xl font-bold text-blue-600">üèùÔ∏è Galapagos Logistics</h1>
                <p class="text-gray-600">Tableau de bord - Donn√©es GraphQL</p>
            </div>
            <button onclick="chargerTout()" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 font-semibold">
                üîÑ Rafra√Æchir
            </button>
        </div>

        <!-- Hydravions -->
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-blue-700 mb-4">‚úàÔ∏è Hydravions</h2>
            <div id="hydravions" class="bg-white rounded-lg shadow p-6">
                <p class="text-gray-400">Chargement...</p>
            </div>
        </div>

        <!-- Clients -->
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-green-700 mb-4">üë• Clients</h2>
            <div id="clients" class="bg-white rounded-lg shadow p-6">
                <p class="text-gray-400">Chargement...</p>
            </div>
        </div>

        <!-- Commandes -->
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-purple-700 mb-4">üì¶ Commandes</h2>
            <div id="commandes" class="bg-white rounded-lg shadow p-6">
                <p class="text-gray-400">Chargement...</p>
            </div>
        </div>

        <!-- √éles -->
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-yellow-700 mb-4">üèùÔ∏è √éles</h2>
            <div id="iles" class="bg-white rounded-lg shadow p-6">
                <p class="text-gray-400">Chargement...</p>
            </div>
        </div>

        <!-- Produits -->
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-red-700 mb-4">üì¶ Produits</h2>
            <div id="produits" class="bg-white rounded-lg shadow p-6">
                <p class="text-gray-400">Chargement...</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8001/graphql';

        async function graphql(query) {
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                const data = await res.json();
                return data.data;
            } catch (error) {
                console.error('Erreur GraphQL:', error);
                return null;
            }
        }

        async function chargerHydravions() {
            const query = `{ hydravions { id nom modele statut capacite_caisses port_actuel } }`;
            const data = await graphql(query);
            const div = document.getElementById('hydravions');

            if (!data || !data.hydravions || data.hydravions.length === 0) {
                div.innerHTML = '<p class="text-gray-500">Aucun hydravion</p>';
                return;
            }

            div.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${data.hydravions.map(h => `
                        <div class="border border-blue-200 p-4 rounded-lg bg-blue-50">
                            <h3 class="font-bold text-lg text-blue-900">${h.nom}</h3>
                            <p class="text-sm text-gray-700 mt-2"><strong>Mod√®le:</strong> ${h.modele}</p>
                            <p class="text-sm text-gray-700"><strong>Statut:</strong> ${h.statut}</p>
                            <p class="text-sm text-gray-700"><strong>Capacit√©:</strong> ${h.capacite_caisses} caisses</p>
                            <p class="text-sm text-gray-700"><strong>Port:</strong> ${h.port_actuel || 'N/A'}</p>
                        </div>
                    `).join('')}
                </div>
                <p class="text-gray-500 text-sm mt-4">Total: ${data.hydravions.length} hydravion(s)</p>
            `;
        }

        async function chargerClients() {
            const query = `{ clients { id nom prenom email role organisation ile_principale } }`;
            const data = await graphql(query);
            const div = document.getElementById('clients');

            if (!data || !data.clients || data.clients.length === 0) {
                div.innerHTML = '<p class="text-gray-500">Aucun client</p>';
                return;
            }

            div.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${data.clients.map(c => `
                        <div class="border border-green-200 p-4 rounded-lg bg-green-50">
                            <h3 class="font-bold text-lg text-green-900">${c.prenom} ${c.nom}</h3>
                            <p class="text-sm text-gray-700 mt-2"><strong>Role:</strong> ${c.role}</p>
                            <p class="text-sm text-gray-700"><strong>Organisation:</strong> ${c.organisation}</p>
                            <p class="text-sm text-gray-700"><strong>√éle:</strong> ${c.ile_principale}</p>
                            <p class="text-sm text-gray-700"><strong>Email:</strong> ${c.email}</p>
                        </div>
                    `).join('')}
                </div>
                <p class="text-gray-500 text-sm mt-4">Total: ${data.clients.length} client(s)</p>
            `;
        }

        async function chargerCommandes() {
            const query = `{ commandes { id port_destination statut priorite nombre_caisses_requises client { nom prenom } } }`;
            const data = await graphql(query);
            const div = document.getElementById('commandes');

            if (!data || !data.commandes || data.commandes.length === 0) {
                div.innerHTML = '<p class="text-gray-500">Aucune commande</p>';
                return;
            }

            div.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${data.commandes.map(cmd => `
                        <div class="border border-purple-200 p-4 rounded-lg bg-purple-50">
                            <h3 class="font-bold text-lg text-purple-900">Commande #${cmd.id}</h3>
                            <p class="text-sm text-gray-700 mt-2"><strong>Destination:</strong> ${cmd.port_destination}</p>
                            <p class="text-sm text-gray-700"><strong>Client:</strong> ${cmd.client ? cmd.client.prenom + ' ' + cmd.client.nom : 'N/A'}</p>
                            <p class="text-sm text-gray-700"><strong>Statut:</strong> ${cmd.statut}</p>
                            <p class="text-sm text-gray-700"><strong>Priorit√©:</strong> ${cmd.priorite}</p>
                            <p class="text-sm text-gray-700"><strong>Caisses:</strong> ${cmd.nombre_caisses_requises}</p>
                        </div>
                    `).join('')}
                </div>
                <p class="text-gray-500 text-sm mt-4">Total: ${data.commandes.length} commande(s)</p>
            `;
        }

        async function chargerIles() {
            const query = `{ iles { nom superficie population description coordonnees { latitude longitude } } }`;
            const data = await graphql(query);
            const div = document.getElementById('iles');

            if (!data || !data.iles || data.iles.length === 0) {
                div.innerHTML = '<p class="text-gray-500">Aucune √Æle</p>';
                return;
            }

            div.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${data.iles.map(i => `
                        <div class="border border-yellow-200 p-4 rounded-lg bg-yellow-50">
                            <h3 class="font-bold text-lg text-yellow-900">üèùÔ∏è ${i.nom}</h3>
                            <p class="text-sm text-gray-700 mt-2">${i.description}</p>
                            <p class="text-sm text-gray-700 mt-2"><strong>Superficie:</strong> ${i.superficie} km¬≤</p>
                            <p class="text-sm text-gray-700"><strong>Population:</strong> ${i.population || 0}</p>
                            <p class="text-sm text-gray-700"><strong>Coordonn√©es:</strong> ${i.coordonnees.latitude.toFixed(2)}, ${i.coordonnees.longitude.toFixed(2)}</p>
                        </div>
                    `).join('')}
                </div>
                <p class="text-gray-500 text-sm mt-4">Total: ${data.iles.length} √Æle(s)</p>
            `;
        }

        async function chargerProduits() {
            const query = `{ produits { id nom categorie poids stock_disponible } }`;
            const data = await graphql(query);
            const div = document.getElementById('produits');

            if (!data || !data.produits || data.produits.length === 0) {
                div.innerHTML = '<p class="text-gray-500">Aucun produit</p>';
                return;
            }

            div.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${data.produits.map(p => `
                        <div class="border border-red-200 p-4 rounded-lg bg-red-50">
                            <h3 class="font-bold text-lg text-red-900">${p.nom}</h3>
                            <p class="text-sm text-gray-700 mt-2"><strong>Cat√©gorie:</strong> ${p.categorie}</p>
                            <p class="text-sm text-gray-700"><strong>Poids:</strong> ${p.poids} kg</p>
                            <p class="text-sm text-gray-700"><strong>Stock:</strong> ${p.stock_disponible}</p>
                        </div>
                    `).join('')}
                </div>
                <p class="text-gray-500 text-sm mt-4">Total: ${data.produits.length} produit(s)</p>
            `;
        }

        async function chargerTout() {
            await Promise.all([
                chargerHydravions(),
                chargerClients(),
                chargerCommandes(),
                chargerIles(),
                chargerProduits()
            ]);
        }

        // Charger automatiquement au d√©marrage
        window.onload = chargerTout;
    </script>
</body>
</html>
